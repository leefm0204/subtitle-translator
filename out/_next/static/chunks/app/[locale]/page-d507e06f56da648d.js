(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61],{56723:function(e,t,a){Promise.resolve().then(a.bind(a,1573)),Promise.resolve().then(a.bind(a,79441)),Promise.resolve().then(a.bind(a,33671))},33671:function(e,t,a){"use strict";a.d(t,{default:function(){return eD}});var n=a(57437),l=a(2265),r=a(43889),o=a(14480),i=a(2474),s=a(67187),c=a(74735),u=a(41021),d=a(5945),g=a(28961),p=a(92770),m=a(5545),h=a(56053),v=a(5978),y=a.n(v),f=a(38706);let b=["deepl","deeplx"],x=[{value:"auto",labelKey:"languages.auto",nativeLabel:"Auto",name:"Auto"},{value:"en",labelKey:"languages.english",nativeLabel:"English",name:"English"},{value:"zh",labelKey:"languages.chinese",nativeLabel:"简体",name:"Simplified Chinese"},{value:"zh-hant",labelKey:"languages.traditionalChinese",nativeLabel:"繁體",name:"Traditional Chinese"},{value:"es",labelKey:"languages.spanish",nativeLabel:"Espa\xf1ol",name:"Spanish"},{value:"de",labelKey:"languages.german",nativeLabel:"Deutsch",name:"German"},{value:"pt-br",labelKey:"languages.portugueseBrazil",nativeLabel:"Portugu\xeas (Brasil)",name:"Portuguese (Brazil)"},{value:"pt-pt",labelKey:"languages.portuguesePortugal",nativeLabel:"Portugu\xeas (Portugal)",name:"Portuguese (Portugal)"},{value:"ar",labelKey:"languages.arabic",nativeLabel:"العربية",name:"Arabic"},{value:"ja",labelKey:"languages.japanese",nativeLabel:"日本語",name:"Japanese"},{value:"ko",labelKey:"languages.korean",nativeLabel:"한국어",name:"Korean"},{value:"ru",labelKey:"languages.russian",nativeLabel:"Русский",name:"Russian"},{value:"fr",labelKey:"languages.french",nativeLabel:"Fran\xe7ais",name:"French"},{value:"it",labelKey:"languages.italian",nativeLabel:"Italiano",name:"Italian"},{value:"tr",labelKey:"languages.turkish",nativeLabel:"T\xfcrk\xe7e",name:"Turkish"},{value:"pl",labelKey:"languages.polish",nativeLabel:"Polski",name:"Polish"},{value:"uk",labelKey:"languages.ukrainian",nativeLabel:"Українська",name:"Ukrainian"},{value:"ro",labelKey:"languages.romanian",nativeLabel:"Rom\xe2nă",name:"Romanian"},{value:"hu",labelKey:"languages.hungarian",nativeLabel:"Magyar",name:"Hungarian"},{value:"cs",labelKey:"languages.czech",nativeLabel:"Čeština",name:"Czech"},{value:"sk",labelKey:"languages.slovak",nativeLabel:"Slovenčina",name:"Slovak"},{value:"bg",labelKey:"languages.bulgarian",nativeLabel:"Български",name:"Bulgarian"},{value:"sv",labelKey:"languages.swedish",nativeLabel:"Svenska",name:"Swedish"},{value:"da",labelKey:"languages.danish",nativeLabel:"Dansk",name:"Danish"},{value:"fi",labelKey:"languages.finnish",nativeLabel:"Suomi",name:"Finnish"},{value:"nb",labelKey:"languages.norwegian",nativeLabel:"Norsk bokm\xe5l",name:"Norwegian"},{value:"lt",labelKey:"languages.lithuanian",nativeLabel:"Lietuvių",name:"Lithuanian"},{value:"lv",labelKey:"languages.latvian",nativeLabel:"Latviešu",name:"Latvian"},{value:"et",labelKey:"languages.estonian",nativeLabel:"Eesti",name:"Estonian"},{value:"el",labelKey:"languages.greek",nativeLabel:"Ελληνικά",name:"Greek"},{value:"sl",labelKey:"languages.slovenian",nativeLabel:"Slovenščina",name:"Slovenian"},{value:"nl",labelKey:"languages.dutch",nativeLabel:"Nederlands",name:"Dutch"},{value:"id",labelKey:"languages.indonesian",nativeLabel:"Bahasa Indonesia",name:"Indonesian"},{value:"ms",labelKey:"languages.malay",nativeLabel:"Bahasa Melayu",name:"Malay",unsupportedMethods:b},{value:"vi",labelKey:"languages.vietnamese",nativeLabel:"Tiếng Việt",name:"Vietnamese",unsupportedMethods:b},{value:"hi",labelKey:"languages.hindi",nativeLabel:"हिन्दी",name:"Hindi",unsupportedMethods:b},{value:"bn",labelKey:"languages.bengali",nativeLabel:"বাংলা",name:"Bengali",unsupportedMethods:b},{value:"bho",labelKey:"languages.bhojpuri",nativeLabel:"भोजपुरी",name:"Bhojpuri",unsupportedMethods:b},{value:"mr",labelKey:"languages.marathi",nativeLabel:"मराठी",name:"Marathi",unsupportedMethods:b},{value:"gu",labelKey:"languages.gujarati",nativeLabel:"ગુજરાતી",name:"Gujarati",unsupportedMethods:b},{value:"ta",labelKey:"languages.tamil",nativeLabel:"தமிழ்",name:"Tamil",unsupportedMethods:b},{value:"te",labelKey:"languages.telugu",nativeLabel:"తెలుగు",name:"Telugu",unsupportedMethods:b},{value:"kn",labelKey:"languages.kannada",nativeLabel:"ಕನ್ನಡ",name:"Kannada",unsupportedMethods:b},{value:"th",labelKey:"languages.thai",nativeLabel:"ไทย",name:"Thai",unsupportedMethods:b},{value:"fil",labelKey:"languages.filipino",nativeLabel:"Filipino",name:"Filipino(Tagalog)",unsupportedMethods:b},{value:"jv",labelKey:"languages.javanese",nativeLabel:"Basa Jawa",name:"Javanese",unsupportedMethods:["deepl","deeplx","azure"]},{value:"he",labelKey:"languages.hebrew",nativeLabel:"עברית",name:"Hebrew",unsupportedMethods:b},{value:"am",labelKey:"languages.amharic",nativeLabel:"አማርኛ",name:"Amharic",unsupportedMethods:b},{value:"fa",labelKey:"languages.persian",nativeLabel:"فارسی",name:"Persian",unsupportedMethods:b},{value:"ug",labelKey:"languages.uyghur",nativeLabel:"ئۇيغۇرچە",name:"Uyghur",unsupportedMethods:b},{value:"ha",labelKey:"languages.hausa",nativeLabel:"هَرْشٜىٰن هَوْسَا",name:"Hausa",unsupportedMethods:b},{value:"sw",labelKey:"languages.swahili",nativeLabel:"Kiswahili",name:"Swahili",unsupportedMethods:b},{value:"uz",labelKey:"languages.uzbek",nativeLabel:"Oʻzbekcha",name:"Uzbek",unsupportedMethods:b},{value:"kk",labelKey:"languages.kazakh",nativeLabel:"Қазақ тілі",name:"Kazakh",unsupportedMethods:b},{value:"ky",labelKey:"languages.kyrgyz",nativeLabel:"Кыргызча",name:"Kyrgyz",unsupportedMethods:b},{value:"tk",labelKey:"languages.turkmen",nativeLabel:"T\xfcrkmen\xe7e",name:"Turkmen",unsupportedMethods:b},{value:"ur",labelKey:"languages.urdu",nativeLabel:"اردو",name:"Urdu",unsupportedMethods:b},{value:"hr",labelKey:"languages.croatian",nativeLabel:"Hrvatski",name:"Croatian",unsupportedMethods:b}],T=()=>{let e=(0,f.T)();return{sourceOptions:x.map(t=>({...t,label:"".concat(e(t.labelKey)," (").concat(t.nativeLabel,")")})),targetOptions:x.filter(e=>"auto"!==e.value).map(t=>({...t,label:"".concat(e(t.labelKey)," (").concat(t.nativeLabel,")")}))}},w=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.trim().toLowerCase()},S=e=>{let{input:t,option:a}=e,n=w(t),l=w(null==a?void 0:a.label),r=w(null==a?void 0:a.name);return l.includes(n)||r.includes(n)},j=[{value:"gtxFreeAPI",label:"GTX API (Free)"},{value:"google",label:"Google Translate",docs:"https://cloud.google.com/translate/docs/basic/translate-text-basic"},{value:"deepl",label:"DeepL",docs:"https://developers.deepl.com/docs/api-reference/translate"},{value:"azure",label:"Azure Translate",docs:"https://learn.microsoft.com/zh-cn/azure/ai-services/translator/reference/v3-0-translate"},{value:"deeplx",label:"DeepLX (Free)",docs:"https://deeplx.owo.network/endpoints/free.html"},{value:"deepseek",label:"DeepSeek",docs:"https://api-docs.deepseek.com/zh-cn/"},{value:"openai",label:"OpenAI",docs:"https://platform.openai.com/docs/api-reference/chat"},{value:"gemini",label:"Gemini",docs:"https://ai.google.dev/gemini-api/docs/text-generation"},{value:"azureopenai",label:"Azure OpenAI",docs:"https://learn.microsoft.com/zh-cn/azure/ai-services/openai/concepts/models"},{value:"siliconflow",label:"SiliconFlow",docs:"https://docs.siliconflow.cn/api-reference/chat-completions/chat-completions"},{value:"groq",label:"Groq",docs:"https://console.groq.com/docs/text-chat"},{value:"llm",label:"Custom LLM"}],L=e=>{let t=j.find(t=>t.value===e);return t?t.label:e},C=["deepseek","openai","gemini","azureopenai","siliconflow","groq","llm"],P=[...j.filter(e=>!C.includes(e.value)),{label:"AI LLM Models",options:j.filter(e=>C.includes(e.value))}],k={gtxFreeAPI:{limit:100},deeplx:{url:"",chunkSize:1e3,delayTime:200,limit:10},deepl:{url:"",apiKey:"",chunkSize:5e3,delayTime:200,limit:20},deepseek:{apiKey:"",model:"deepseek-chat",temperature:.7,limit:30},openai:{apiKey:"",model:"gpt-5-mini",temperature:1,limit:30},gemini:{apiKey:"",model:"gemini-2.5-flash",temperature:.7,limit:30},azureopenai:{url:"",apiKey:"",model:"gpt-5-mini",apiVersion:"2025-08-07",temperature:.7,limit:30},siliconflow:{apiKey:"",model:"deepseek-ai/DeepSeek-V3",temperature:.7,limit:30},groq:{apiKey:"",model:"openai/gpt-oss-20b",temperature:.7,limit:30},llm:{url:"http://127.0.0.1:11434/v1/chat/completions",apiKey:"",model:"llama3.2",temperature:.7,limit:20},azure:{apiKey:"",chunkSize:1e4,delayTime:200,region:"eastasia",limit:100},google:{apiKey:"",delayTime:200,limit:100},webgoogletranslate:{limit:1}},E=(e,t)=>{let a=Object.keys(e).sort(),n=Object.keys(t).sort();return JSON.stringify(a)===JSON.stringify(n)},A=e=>{let t=x.find(t=>t.value===e);return t?t.name:e};x.map(e=>e.value);let K=(e,t,a)=>{var n,l;let r=x.find(e=>e.value===t),o=x.find(e=>e.value===a);if(!r||!o)return console.error("Invalid language code provided"),!1;let i=null===(n=r.unsupportedMethods)||void 0===n?void 0:n.includes(e),s=null===(l=o.unsupportedMethods)||void 0===l?void 0:l.includes(e);return!i&&!s||(i&&u.ZP.error({content:"".concat(e.toUpperCase()," doesn't support ").concat(r.name,". Switching to free GTX API now."),duration:10}),s&&u.ZP.error({content:"".concat(e.toUpperCase()," doesn't support ").concat(o.name,". Switching to free GTX API now."),duration:10}),!1)},Z=(e,t,a)=>{let n=[],l="";return e.split(a).forEach(e=>{l.length+e.length+1>t?(n.push(l),l=e):l+=l?a+e:e}),l&&n.push(l),n},M=function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l="".concat(t,"_").concat(e,"_").concat(a);if(C.includes(a)){let e=JSON.stringify({model:n.model||"",temperature:n.temperature||0,sysPrompt:n.sysPrompt||"",userPrompt:n.userPrompt||""}),t=y().hash(e);l="".concat(l,"_").concat(t)}return l},N=(e,t)=>{if(e.length>32)return"".concat("t_").concat(y().hash(e),"_").concat(t);let a=encodeURIComponent(e);return a.length>50?"".concat("t_").concat(y().hash(e),"_").concat(t):"".concat("t_").concat(a,"_").concat(t)},z=(e,t,a,n)=>{let l=t;return"auto"===n&&(l=l.replace(/from \${sourceLanguage} (to|into)/g,"into")),l=l.replace("${sourceLanguage}",A(n)).replace("${targetLanguage}",A(a)).replace("${content}",e)},I={gtxFreeAPI:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n}=e,l="https://translate.googleapis.com/translate_a/single?client=gtx&sl=".concat(n,"&tl=").concat(a,"&dt=t&q=").concat(encodeURIComponent(t)),r=await fetch(l);if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));return(await r.json())[0].map(e=>e[0]).join("")},google:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n,apiKey:l}=e,r={q:t,target:a,..."auto"!==n&&{source:n}},o=await fetch("https://translation.googleapis.com/language/translate/v2?key=".concat(l),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return(await o.json()).data.translations[0].translatedText},deepl:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n,url:l,apiKey:r}=e,o={text:t,target_lang:a,authKey:r,..."auto"!==n&&{source_lang:n}},i=await fetch(l||"https://api-edgeone.newzone.top/api/deepl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),s=await i.json();if(!i.ok)throw Error(s.error||"HTTP error! status: ".concat(i.status));return s.translations[0].text},deeplx:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n,url:l}=e,r={text:t,target_lang:a,..."auto"!==n&&{source_lang:n}},o=await fetch(l||"https://deeplx.aishort.top/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),i=await o.json();if(!o.ok)throw Error(i.error||"HTTP error! status: ".concat(o.status));return i.data},azure:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n,apiKey:l,region:r}=e,o="https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=".concat(a).concat("auto"!==n?"&from=".concat(n):""),i=await fetch(o,{method:"POST",headers:{"Ocp-Apim-Subscription-Key":l,"Ocp-Apim-Subscription-Region":r,"Content-Type":"application/json"},body:JSON.stringify([{Text:t}])}),s=await i.json();if(!i.ok)throw Error(s.error||"HTTP error! status: ".concat(i.status));return s[0].translations[0].text},deepseek:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n,apiKey:l,model:r,temperature:o,sysPrompt:i,userPrompt:s}=e,c=z(t,s,a,n),u=await fetch("https://api.deepseek.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify({messages:[{role:"system",content:i},{role:"user",content:c}],model:r,temperature:Number(o),stream:!1,timeout:6e5})});return(await u.json()).choices[0].message.content.trim()},openai:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n,apiKey:l,model:r,temperature:o,sysPrompt:i,userPrompt:s}=e,c=z(t,s,a,n),u=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify({messages:[{role:"system",content:i},{role:"user",content:c}],model:r,temperature:1})});return(await u.json()).choices[0].message.content.trim()},gemini:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n,apiKey:l,model:r,temperature:o,sysPrompt:i,userPrompt:s}=e,c={contents:[{parts:[{text:z(t,s,a,n)}]}],systemInstruction:{parts:[{text:i}]},generationConfig:{temperature:Number(o)}},u=await fetch("https://generativelanguage.googleapis.com/v1beta/models/".concat(r,":generateContent?key=").concat(l),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),d=await u.json();if(!u.ok){var g;throw Error((null===(g=d.error)||void 0===g?void 0:g.message)||"HTTP error! status: ".concat(u.status))}if(!d.candidates||!d.candidates[0]||!d.candidates[0].content)throw Error("Invalid response format from Gemini API");return d.candidates[0].content.parts[0].text.trim()},azureopenai:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n,apiKey:l,url:r,model:o,apiVersion:i,temperature:s,sysPrompt:c,userPrompt:u}=e,d=z(t,u,a,n),g=r.replace(/\/+$/,""),p="".concat(g,"/openai/deployments/").concat(o,"/chat/completions?api-version=").concat(i),m=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json","api-key":l},body:JSON.stringify({messages:[{role:"system",content:c},{role:"user",content:d}],temperature:Number(s)})});return(await m.json()).choices[0].message.content.trim()},siliconflow:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n,apiKey:l,model:r,temperature:o,sysPrompt:i,userPrompt:s}=e,c=z(t,s,a,n),u=await fetch("https://api.siliconflow.cn/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify({messages:[{role:"system",content:i},{role:"user",content:c}],model:r,temperature:Number(o)})});return(await u.json()).choices[0].message.content.trim()},groq:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n,apiKey:l,model:r,temperature:o,sysPrompt:i,userPrompt:s}=e,c=z(t,s,a,n),u=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify({messages:[{role:"system",content:i},{role:"user",content:c}],model:r,temperature:Number(o),stream:!1})});return(await u.json()).choices[0].message.content.trim()},llm:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n,apiKey:l,url:r,model:o,temperature:i,sysPrompt:s,userPrompt:c}=e,u=z(t,c,a,n),d={"Content-Type":"application/json"};(null==l?void 0:l.trim())&&(d.Authorization="Bearer ".concat(l));let g=await fetch(r||"http://127.0.0.1:61234/v1/chat/completions",{method:"POST",headers:d,body:JSON.stringify({messages:[{role:"system",content:s},{role:"user",content:u}],model:o,temperature:Number(i)})});return(await g.json()).choices[0].message.content.trim()},webgoogletranslate:async e=>{let{text:t,targetLanguage:a,sourceLanguage:n}=e,l={q:t,target:a,..."auto"!==n&&{source:n}},r=await fetch("api/webgoogletranslate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!r.ok)throw Error("Failed to translate text");return(await r.json()).translatedText}},O=async(e,t,a,n)=>{try{let l={text:"Hello, world!",targetLanguage:"zh",sourceLanguage:"en",...t,...a&&{sysPrompt:a},...n&&{userPrompt:n}};if(!await I[e](l))throw Error("Translation Test failed, no result received.");return!0}catch(e){return console.error("Translation Test failed",e),!1}},F=async e=>{try{let{text:t,cacheSuffix:a,translationMethod:n,targetLanguage:l,sourceLanguage:r,useCache:o=!0,apiKey:i,region:s="eastasia",url:c,model:u,apiVersion:d,temperature:g,sysPrompt:p,userPrompt:m}=e;if(!RegExp("[a-zA-Z\\p{L}]","u").test(t)||r===l)return t;let h=N(t,a);if(o){let e=localStorage.getItem(h);if(e)return e}let v=I[n];if(!v)throw Error("Unsupported translation method: ".concat(n));let y=await v(e);if(!y)return console.warn("No translation result received for method: ".concat(n)),null;let f=y.replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");return localStorage.setItem(h,f),f}catch(e){return console.error("Translation failed:",e),null}},R=()=>({translate:(0,l.useCallback)(async e=>await F(e),[])}),_=e=>{let t=localStorage.getItem(e);if(null===t)return null;try{return JSON.parse(t)}catch(e){return null}},U=(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(t){console.error('Error saving key "'.concat(e,'" to localStorage:'),t)}},D=e=>e.includes("\r")?e.replace(/\r\n?/g,"\n"):e,B=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return[];let a=D(e).split("\n");return t.removeEmptyLines&&(a=a.filter(Boolean)),a},J=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e5;return e.length<=t?e:"".concat(e.slice(0,t),"...")},H=new Intl.NumberFormat("en-US",{notation:"compact",compactDisplay:"short"}),$=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e6,a=e.length,n=B(e).length,l=a>t,r=l?J(e):e;return{charCount:H.format(a),lineCount:H.format(n),isTooLong:l,displayText:r}},X=e=>e&&e.trim()?e.trim().split(/\s+/).filter(e=>e.length>0):[];var W=a(27929),q=a(72407),G=a(56689);let V=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/plain;charset=utf-8";try{if(window.Capacitor&&"web"!==G.dV.getPlatform()){let a="Download/".concat(t);return await W.fy.writeFile({path:a,data:e,encoding:W.ez.UTF8,directory:W.tP.ExternalStorage}),await q.F.show({text:"Saved to ".concat(a),duration:"long"}),a}{let n=new Blob([e],{type:a}),l=URL.createObjectURL(n),r=document.createElement("a");return r.href=l,r.download=t,document.body.appendChild(r),r.click(),URL.revokeObjectURL(l),document.body.removeChild(r),t}}catch(e){throw await q.F.show({text:"Download failed: ".concat(e.message),duration:"long"}),e}};var Y=a(5378),Q=()=>{let[e,t]=(0,l.useState)(""),[a,n]=(0,l.useState)([]),[r,o]=(0,l.useState)("single"),[i,s]=(0,l.useState)([]),[c,u]=(0,l.useState)(!1),[d,g]=(0,l.useState)(!1),p=(e,t)=>{g(!0);let a=new FileReader;a.onload=e=>{var a;let n=new Uint8Array(null===(a=e.target)||void 0===a?void 0:a.result),l=Array.from(n.subarray(0,Math.min(524288,n.length))).map(e=>String.fromCharCode(e)).join(""),r=Y.detect(l);console.log("Detected encoding",r),t(D(new TextDecoder(r.encoding||"utf-8").decode(n))),g(!1)},a.onerror=e=>{console.error("读取文件出错：",e),g(!1)},a.readAsArrayBuffer(e)},m=()=>{s([]),n([]),t(""),o("single")};return{isFileProcessing:d,fileList:i,multipleFiles:a,readFile:p,sourceText:e,setSourceText:t,uploadMode:r,singleFileMode:c,setSingleFileMode:u,handleFileUpload:e=>("single"===r?(t(""),n([e]),p(e,e=>{t(e)})):n(t=>{if(!t.some(t=>t.name===e.name&&t.size===e.size)){let a=[...t,e];return console.log("New multiple files",a),a}return t}),!1),handleUploadRemove:e=>{s(i.filter(t=>t.uid!==e.uid)),n(a=>{let n=a.filter(t=>!(t.name===e.name&&t.size===e.size));return 1===n.length&&"multiple"===r&&(o("single"),p(n[0],e=>{t(e)})),n})},handleUploadChange:e=>{let{fileList:a}=e,n=a.map(e=>({uid:e.uid,name:e.name,status:"done",size:e.size,originFileObj:e.originFileObj})).filter((e,t,a)=>t===a.findIndex(t=>t.name===e.name&&t.size===e.size));s(n),n.length>1&&"single"===r?(t(""),o("multiple")):0===n.length&&m()},resetUpload:m}},ee=a(42998),et=a(9912);let ea="You are a professional translator. Respond only with the content, either translated or rewritten. Do not add explanations, comments, or any extra text.",en="Please respect the original meaning, maintain the original format, and rewrite the following content in ${targetLanguage}.\n\n${content}",el="gtxFreeAPI";var er=()=>{let e=(0,f.T)("languages"),t=(0,f.T)("common"),{translate:a}=R(),[n,r]=(0,l.useState)(el),[o,i]=(0,l.useState)(k),[s,c]=(0,l.useState)(ea),[d,g]=(0,l.useState)(en),[p,m]=(0,l.useState)("auto"),[h,v]=(0,l.useState)("zh"),[y,b]=(0,l.useState)(["zh"]),[x,T]=(0,l.useState)(!0),[w,S]=(0,l.useState)(""),[j,L]=(0,l.useState)(""),[P,A]=(0,l.useState)(""),[N,z]=(0,l.useState)(!1),[I,F]=(0,l.useState)(!1),[D,B]=(0,l.useState)(0),[J,H]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(()=>{var e;let t=_("translationConfigs");t&&i(t),c(_("sysPrompt")||ea),g(_("userPrompt")||en),r(_("translationMethod")||el),m(_("sourceLanguage")||"auto"),v(_("targetLanguage")||"zh"),b(_("target_langs")||["zh"]),H(null!==(e=_("multiLanguageMode"))&&void 0!==e&&e),S(_("removeChars")||""),z(!0)})()},[]),(0,l.useEffect)(()=>{N&&(U("translationConfigs",o),U("sysPrompt",s),U("userPrompt",d),U("translationMethod",n),U("sourceLanguage",p),U("targetLanguage",h),U("target_langs",y),U("multiLanguageMode",J),U("removeChars",w))},[o,s,d,n,p,h,y,J,w,N]);let $=async()=>{try{let e={translationConfigs:_("translationConfigs"),sysPrompt:_("sysPrompt"),userPrompt:_("userPrompt"),translationMethod:_("translationMethod"),sourceLanguage:_("sourceLanguage"),targetLanguage:_("targetLanguage"),target_langs:_("target_langs"),multiLanguageMode:_("multiLanguageMode"),exportDate:new Date().toISOString(),version:"1.0"},a=JSON.stringify(e,null,2),n="translation-settings-".concat(new Date().toISOString().split("T")[0],".json");await V(a,n,"application/json"),u.ZP.success(t("exportSettingSuccess"))}catch(e){console.error(t("exportSettingError"),e),u.ZP.error(t("exportSettingError"))}},{readFile:X}=Q(),W=()=>{let e=n;o[e]||k[e]||(r(el),e=el);let t=o[e],a=k[e];return t&&E(t,a)?t:(q(e),a)},q=e=>{i(t=>{let a=t[e]||{},n=k[e];return{...t,[e]:{...n,...void 0!==a.apiKey?{apiKey:a.apiKey}:{}}}})},G=e=>new Promise(t=>setTimeout(t,e)),Y=async()=>{let e=W();if(e&&"apiKey"in e&&!e.apiKey&&"llm"!==n)return u.ZP.error(t("enterApiKey")),!1;if("llm"===n&&!e.url)return u.ZP.error(t("enterLlmUrl")),!1;if(J){for(let e of y)if(!K(n,p,e))return r(el),!1}else if(!K(n,p,h))return r(el),!1;if(["deepl","deeplx","llm","gtxFreeAPI"].includes(n)){F(!0),B(1);let a="llm"===n?s:void 0,l="llm"===n?d:void 0;if(!0!==await O(n,e,a,l)){let e;switch(n){case"deeplx":e=t("deepLXUnavailable"),r(el);break;case"deepl":e=t("deeplUnavailable");break;case"llm":e=t("llmUnavailable");break;case"gtxFreeAPI":e="GTX Free 接口当前不可用，请检查您的网络连接。The free Google Translate API (GTX) is currently unavailable. Please check your network connection.";break;default:e=t("translationError")}return u.ZP.open({type:"error",content:e,duration:10}),F(!1),!1}F(!1)}return!0},er=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(L(""),!t.trim()){u.ZP.error("No source text provided.");return}await Y()&&(F(!0),B(0),await e(t,void 0,void 0,void 0,a),F(!1),A(""))},eo=(0,l.useCallback)(e=>{let t={retries:3,factor:2,minTimeout:1e3,maxTimeout:3e4,randomize:!0};switch(e){case"gtxFreeAPI":return{...t,retries:5,minTimeout:2e3,maxTimeout:6e4,shouldRetry:e=>{var t;let{error:a}=e,n=(null==a?void 0:a.status)||(null==a?void 0:null===(t=a.response)||void 0===t?void 0:t.status);return!n||n>=500||429===n}};case"deeplx":return{...t,retries:4,minTimeout:1500,shouldRetry:e=>{var t,a;let{error:n}=e,l=(null==n?void 0:null===(t=n.message)||void 0===t?void 0:t.toLowerCase())||"",r=(null==n?void 0:n.status)||(null==n?void 0:null===(a=n.response)||void 0===a?void 0:a.status);return!l.includes("unauthorized")&&(!r||r>=500||429===r)}};case"deepl":case"google":case"azure":return{...t,retries:2,minTimeout:500,maxTimeout:1e4,shouldRetry:e=>{var t;let{error:a}=e,n=(null==a?void 0:a.status)||(null==a?void 0:null===(t=a.response)||void 0===t?void 0:t.status);return!n||n>=500||429===n}};case"openai":case"deepseek":case"gemini":case"azureopenai":case"siliconflow":case"groq":case"llm":return{...t,retries:3,minTimeout:1e3,maxTimeout:2e4,shouldRetry:e=>{var t,a;let{error:n}=e,l=(null==n?void 0:null===(t=n.message)||void 0===t?void 0:t.toLowerCase())||"",r=(null==n?void 0:n.status)||(null==n?void 0:null===(a=n.response)||void 0===a?void 0:a.status);return!(l.includes("context length")||l.includes("token limit"))&&(!r||r>=500||429===r)}};default:return t}},[]);async function ei(e,t,n){let l=eo(n.translationMethod);try{return await (0,et.ZP)(async()=>a({text:e,cacheSuffix:t,...n}),{...l,onFailedAttempt:async t=>{var a,n;let{error:l,attemptNumber:r,retriesLeft:o}=t,i=e.length>30?"".concat(e.substring(0,30),"..."):e;console.warn("Translation attempt ".concat(r,' failed for "').concat(i,'": ').concat(l.message," (").concat(o," retries left)"));let s=(null==l?void 0:l.status)||(null==l?void 0:null===(a=l.response)||void 0===a?void 0:a.status),c=null==l?void 0:null===(n=l.message)||void 0===n?void 0:n.toLowerCase();if(429===s||(null==c?void 0:c.includes("rate limit"))){let e=Math.min(1e3*Math.pow(2,r),3e4);console.log("Rate limit detected, waiting ".concat(e,"ms before retry...")),await G(e)}}})}catch(a){let t=e.length>30?"".concat(e.substring(0,30),"..."):e;return console.warn('All translation attempts failed for: "'.concat(t,'". Using original text.')),e}}let es=async function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=W(),i=Math.max(Number(null==o?void 0:o.limit)||10,1),c=(null==o?void 0:o.delayTime)||200,u=(0,ee.Z)(i);try{if(!e.length)return[];let i=(e,t)=>{B((n+e/t)/l*100)},g={translationMethod:t,targetLanguage:a,sourceLanguage:p,useCache:x,sysPrompt:s,userPrompt:d,...o},m=await M(p,a,t,{model:null==o?void 0:o.model,temperature:null==o?void 0:o.temperature,sysPrompt:s,userPrompt:d});if(r&&C.includes(t)&&e.length>1)return await ec(e,g,m,i);if((null==o?void 0:o.chunkSize)===void 0){let t=Array(e.length),a=0,n=e.map((n,l)=>u(async()=>{t[l]=await ei(n,m,g),(++a%10==0||a===e.length)&&i(a,e.length),c>0&&a<e.length&&await G(c)}));return await Promise.all(n),i(e.length,e.length),t}let h="deeplx"===t?"<>":"\n",v=e.map(e=>e.trim()?e:h).join(h),y=(null==o?void 0:o.chunkSize)||5e3,f=Z(v,y,h),b=[];for(let e=0;e<f.length;e++){let a=await ei(f[e],m,g);b.push("deeplx"===t?null==a?void 0:a.replace(/<>/g,"\n"):a),i(e+1,f.length),e<f.length-1&&await G((null==o?void 0:o.delayTime)||200)}return b.join("\n").split("\n").map((t,a)=>{var n;return(null===(n=e[a])||void 0===n?void 0:n.trim())?t:e[a]||t})}catch(e){throw console.error("Error translating content:",e),e}},ec=async(e,t,a,n)=>{let l=Math.min(t.limit||20,e.length),r=Math.min(25,Math.max(1,Math.floor(l/2))),o=Array(e.length);for(let i=0;i<e.length;i+=l){let s=Math.min(i+l,e.length),c=Math.max(0,i-r),u=Math.min(e.length,s+r),g=e.slice(c,u),p=i-c,m=s-c,h=g.map((e,t)=>t>=p&&t<m?"[TRANSLATE_".concat(t-p,"]").concat(e,"[/TRANSLATE_").concat(t-p,"]"):"[CONTEXT]".concat(e,"[/CONTEXT]")).join("\n");try{let l=await ei(h,a,{...t,userPrompt:d.replace("${content}","Context: This is part of a subtitle file. Only translate the lines marked with [TRANSLATE_X][/TRANSLATE_X] tags (where X is the line number). Use the [CONTEXT][/CONTEXT] lines for understanding but do not translate them. Maintain the natural flow of dialogue and keep the same numbering in your response.\n\nCRITICAL REQUIREMENTS:\n1. You MUST translate ALL ".concat(s-i," lines marked with [TRANSLATE_X] tags\n2. Do NOT skip any numbers from 0 to ").concat(s-i-1,"\n3. Keep the exact format: [TRANSLATE_0]translation[/TRANSLATE_0]\n4. If a line contains only sounds/exclamations, still translate them appropriately\n\n").concat(h))}),r=ed(l,s-i);for(let t=0;t<r.length;t++)i+t<e.length&&r[t]&&(o[i+t]=r[t]);n(s,e.length),s<e.length&&await G(t.delayTime||500)}catch(l){console.warn("Context translation failed for batch ".concat(i,"-").concat(s,", falling back to individual translation"));for(let l=i;l<s;l++){try{o[l]=await ei(e[l],a,t)}catch(t){console.error("Failed to translate line ".concat(l,":"),t),o[l]=e[l]}n(l+1,e.length),l<s-1&&await G(t.delayTime||200)}}}for(let t=0;t<o.length;t++)o[t]||(o[t]=e[t]);return o},eu=e=>e.replace(/\[TRANSLATE_\d+\]/gi,"").replace(/\[\/TRANSLTranslate_\d+\]/gi,"").replace(/\[\/TRANSLATE_\d+\]/gi,"").replace(/\[TRANSLATE\]/gi,"").replace(/\[\/TRANSLATE\]/gi,"").replace(/\[CONTEXT\]/gi,"").replace(/\[\/CONTEXT\]/gi,"").trim(),ed=(e,t)=>{let a=Array(t);for(let n=0;n<t;n++){let t=RegExp("\\[TRANSLATE_".concat(n,"\\]([\\s\\S]*?)\\[/TRANSLATE_").concat(n,"\\]"),"i"),l=e.match(t);l||(t=RegExp("\\[TRANSLATE_".concat(n,"\\]([\\s\\S]*?)\\[/TRANSLTranslate_").concat(n,"\\]"),"i"),l=e.match(t)),l&&(a[n]=eu(l[1].trim()))}return a.filter(e=>e).length>0?a:eg(e,t)},eg=(e,t)=>{let a;let n=/\[TRANSLATE\]([\s\S]*?)\[\/TRANSLATE\]/g,l=[];for(;null!==(a=n.exec(e));)l.push(eu(a[1].trim()));if(l.length===t)return l;let r=e.split("\n").filter(e=>e.trim()).slice(0,t).map(e=>eu(e));return r.length===t?r:Array(t).fill("")};return{exportSettings:$,importSettings:()=>new Promise((e,a)=>{try{let n=document.createElement("input");n.type="file",n.accept=".json",n.style.display="none",n.onchange=n=>{var l;let o=null===(l=n.target.files)||void 0===l?void 0:l[0];if(!o){u.ZP.warning(t("importSettingparseError")),a(Error(t("importSettingparseError")));return}X(o,n=>{try{let a=JSON.parse(n);if(!a||"object"!=typeof a)throw Error(t("importSettingparseError"));void 0!==a.translationConfigs&&(U("translationConfigs",a.translationConfigs),i(a.translationConfigs)),void 0!==a.sysPrompt&&(U("sysPrompt",a.sysPrompt),c(a.sysPrompt)),void 0!==a.userPrompt&&(U("userPrompt",a.userPrompt),g(a.userPrompt)),void 0!==a.translationMethod&&(U("translationMethod",a.translationMethod),r(a.translationMethod)),void 0!==a.sourceLanguage&&(U("sourceLanguage",a.sourceLanguage),m(a.sourceLanguage)),void 0!==a.targetLanguage&&(U("targetLanguage",a.targetLanguage),v(a.targetLanguage)),void 0!==a.target_langs&&(U("target_langs",a.target_langs),b(a.target_langs)),void 0!==a.multiLanguageMode&&(U("multiLanguageMode",a.multiLanguageMode),H(a.multiLanguageMode)),u.ZP.success(t("importSettingSuccess")),e(a)}catch(e){console.error(t("importSettingparseError"),e),u.ZP.error(t("importSettingparseError")),a(Error(t("importSettingparseError")))}})},n.onerror=()=>{u.ZP.error(t("importSettingreadFileError")),a(Error(t("importSettingreadFileError")))},document.body.appendChild(n),n.click();let l=()=>{document.body.contains(n)&&document.body.removeChild(n)};setTimeout(l,100),n.addEventListener("change",l,{once:!0})}catch(e){console.error(t("importSettingError"),e),u.ZP.error(t("importSettingError")),a(e)}}),translationMethod:n,setTranslationMethod:r,translationConfigs:o,getCurrentConfig:W,handleConfigChange:(e,t,a)=>{i(n=>{let l=n[e];return l?{...n,[e]:{...l,[t]:a}}:n})},resetTranslationConfig:q,sysPrompt:s,setSysPrompt:c,userPrompt:d,setUserPrompt:g,useCache:x,setUseCache:T,removeChars:w,setRemoveChars:S,retryTranslate:ei,translateContent:es,handleTranslate:er,sourceLanguage:p,targetLanguage:h,target_langs:y,setTarget_langs:b,multiLanguageMode:J,setMultiLanguageMode:H,translatedText:j,setTranslatedText:L,translateInProgress:I,setTranslateInProgress:F,isClient:N,setIsClient:z,progressPercent:D,setProgressPercent:B,extractedText:P,setExtractedText:A,handleLanguageChange:(a,n)=>{if(n===("source"===a?h:p)){if("source"===a){let a="zh"===n?"en":"zh";m(n),v(a),u.ZP.error("".concat(t("sameLanguageTarget")," ").concat("zh"===a?e("chinese"):e("english")))}else v(n),m("auto"),u.ZP.error("".concat(t("sameLanguageSource")," ").concat(e("auto")));return}"source"===a&&n!==p?m(n):"target"===a&&n!==h&&v(n)},delay:G,validateTranslate:Y}};let{Text:eo,Link:ei}=r.default,{TextArea:es}=c.default;var ec=()=>{let e=(0,f.T)("common"),t=(0,f.T)("TranslationSettings"),[a,r]=u.ZP.useMessage(),{translationMethod:i,setTranslationMethod:s,translationConfigs:v,getCurrentConfig:y,handleConfigChange:b,resetTranslationConfig:x,sysPrompt:T,setSysPrompt:w,userPrompt:S,setUserPrompt:L}=er(),[P,k]=(0,l.useState)(null),E=async()=>{try{let e=Object.keys(localStorage).filter(e=>e.startsWith("t_"));for(let t=0;t<e.length;t+=100)e.slice(t,t+100).forEach(e=>localStorage.removeItem(e)),t+100<e.length&&await new Promise(e=>setTimeout(e,0));a.success("Translation cache has been reset (".concat(e.length," entries cleared)"))}catch(e){console.error("Failed to clear cache:",e),a.error("Failed to clear translation cache")}},A=async(n,l)=>{let r=null==v?void 0:v[n];if(!r){a.error(t("testConfigFail"));return}if(void 0!==r.apiKey&&"llm"!==n&&!"".concat(r.apiKey).trim()){a.error(e("enterApiKey"));return}if(void 0!==r.url){var o;if(!"".concat(null!==(o=r.url)&&void 0!==o?o:"").trim()&&("llm"===n||"azureopenai"===n)){a.error(e("enterLlmUrl"));return}}try{k(n);let e=C.includes(n);await O(n,r,e?T:void 0,e?S:void 0)?a.success("".concat(l||n," - ").concat(t("testConfigSuccess"))):a.error(t("testConfigFail"))}catch(e){console.error("Test config failed",e),a.error(t("testConfigFail"))}finally{k(null)}},K=a=>{let l=j.find(e=>e.value===a),r=y(),o=C.includes(a);return(0,n.jsx)("div",{className:"p-4",children:(0,n.jsx)(d.Z,{title:(0,n.jsxs)(g.Z,{children:[null==l?void 0:l.label,(null==l?void 0:l.docs)&&(0,n.jsx)(ei,{type:"secondary",href:l.docs,target:"_blank",children:"API ".concat(t("docs"))})]}),extra:(0,n.jsxs)(g.Z,{wrap:!0,children:[(0,n.jsx)(p.Z,{title:t("resetCacheTooltip"),children:(0,n.jsx)(m.ZP,{onClick:E,children:t("resetCache")})}),(0,n.jsx)(p.Z,{title:t("testConfigTooltip"),children:(0,n.jsx)(m.ZP,{type:"primary",loading:P===a,onClick:()=>A(a,null==l?void 0:l.label),children:t("testConfig")})}),(0,n.jsx)(m.ZP,{onClick:()=>x(a),children:t("resetConfig")})]}),children:(0,n.jsxs)(h.Z,{layout:"vertical",children:[(null==r?void 0:r.url)!==void 0&&(0,n.jsx)(h.Z.Item,{label:"API ".concat(t("url")),extra:"llm"===a?t("urlExtra"):"azureopenai"===a?void 0:t("deeplxUrlExtra"),required:"llm"===a||"azureopenai"===a,children:(0,n.jsx)(c.default,{placeholder:"llm"===a?"".concat(e("example"),": http://127.0.0.1:11434/v1/chat/completions"):"azureopenai"===a?"".concat(e("example"),": https://your-resource-name.openai.azure.com"):"".concat(e("example"),": http://192.168.2.3:32770/translate"),value:null==r?void 0:r.url,onChange:e=>b(a,"url",e.target.value)})}),(null==r?void 0:r.apiKey)!==void 0&&(0,n.jsx)(h.Z.Item,{label:"".concat(null==l?void 0:l.label," API Key"),required:"llm"!==a,children:(0,n.jsx)(c.default.Password,{autoComplete:"off",placeholder:"".concat(e("enter")," ").concat(null==l?void 0:l.label," API Key"),value:r.apiKey,onChange:e=>b(a,"apiKey",e.target.value)})}),(null==r?void 0:r.region)!==void 0&&(0,n.jsx)(h.Z.Item,{label:"Azure Region",required:!0,children:(0,n.jsx)(c.default,{placeholder:"".concat(e("enter")," Azure API Region"),value:null==r?void 0:r.region,onChange:e=>b(a,"region",e.target.value)})}),(null==r?void 0:r.model)!==void 0&&(0,n.jsx)(h.Z.Item,{label:"LLM ".concat(e("model")),extra:t("modelExtra"),children:(0,n.jsx)(c.default,{value:r.model,onChange:e=>b(a,"model",e.target.value)})}),(null==r?void 0:r.apiVersion)!==void 0&&(0,n.jsx)(h.Z.Item,{label:"LLM API Version",extra:"".concat(e("example"),": 2024-07-18"),children:(0,n.jsx)(c.default,{value:r.apiVersion,onChange:e=>b(a,"apiVersion",e.target.value)})}),(null==r?void 0:r.temperature)!==void 0&&(0,n.jsx)(h.Z.Item,{label:"Temperature",extra:t("temperatureExtra"),children:(0,n.jsx)(c.default,{type:"number",value:r.temperature,onChange:e=>b(a,"temperature",e.target.value)})}),o&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Z.Item,{label:t("systemPrompt"),extra:t("systemPromptExtra"),children:(0,n.jsx)(es,{value:T,onChange:e=>w(e.target.value),autoSize:{minRows:2,maxRows:6}})}),(0,n.jsx)(h.Z.Item,{label:t("userPrompt"),extra:"".concat(t("userPromptExtra"),": ${sourceLanguage} ").concat(t("for")," ").concat(e("sourceLanguage"),", ${targetLanguage} ").concat(t("for")," ").concat(e("targetLanguage"),", ${content} ").concat(t("for")," ").concat(t("textToTranslate")),children:(0,n.jsx)(es,{value:S,onChange:e=>L(e.target.value),autoSize:{minRows:2,maxRows:6}})})]}),(null==r?void 0:r.chunkSize)!==void 0&&(0,n.jsx)(h.Z.Item,{label:t("chunkSize"),extra:t("chunkSizeExtra"),children:(0,n.jsx)(c.default,{type:"number",value:r.chunkSize,onChange:e=>b(a,"chunkSize",e.target.value)})}),(null==r?void 0:r.delayTime)!==void 0&&(0,n.jsx)(h.Z.Item,{label:"".concat(t("delayTime")," (ms)"),children:(0,n.jsx)(c.default,{type:"number",value:r.delayTime,onChange:e=>b(a,"delayTime",e.target.value)})}),(0,n.jsx)(h.Z.Item,{label:t("limit"),extra:t("limitExtra"),children:(0,n.jsx)(c.default,{type:"number",value:null==r?void 0:r.limit,onChange:e=>b(a,"limit",e.target.value)})}),(0,n.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,n.jsxs)(eo,{type:"secondary",children:[t("CurrentTransConfig"),": ",null==l?void 0:l.label]})})]})})})};return(0,n.jsxs)("div",{className:"flex",children:[r,(0,n.jsx)(o.Z,{activeKey:i,onChange:e=>{s(e)},tabPosition:"left",className:"w-full",items:j.map(e=>({key:e.value,label:e.label,children:K(e.value)}))})]})},eu=a(79546),ed=a(10353),eg=a(71806),ep=a(74349),em=a(29967),eh=a(63709),ev=a(10868),ey=a(85883),ef=a(68565),eb=a(46783),ex=a(73879),eT=a(3632),ew=a(23639);let eS=/^(?:\d+:)?\d{2}:\d{2}[,.]\d{1,3} --> (?:\d+:)?\d{2}:\d{2}[,.]\d{1,3}$/,ej=/^\[\d{2}:\d{2}(\.\d{2,3})?\]/,eL=/^\[(ar|ti|al|by|offset|re|ve):/i,eC=e=>{let t=e.slice(0,50).filter(e=>e.trim().length>0),a=0,n=0,l=0,r=0;for(let e=0;e<t.length;e++){let o=t[e].trim();if(/^\[script info\]/i.test(o))return"ass";if(0===e&&/^WEBVTT($|\s)/i.test(o))return"vtt";/^dialogue:\s*\d+,[^,]*,[^,]*,/i.test(o)&&a++,eS.test(o)&&(o.includes(",")?l++:o.includes(".")&&n++),ej.test(o)&&r++,eL.test(o)&&r++}return a>0&&a>=Math.max(n,l,r)?"ass":r>0&&r>=Math.max(n,l)?"lrc":n>l?"vtt":l>0?"srt":"error"},eP=(e,t)=>"lrc"===e?"lrc":t||"ass"===e?"ass":"vtt"===e?"vtt":"srt",ek=/^\d+$/,eE=e=>{let t=e.trim();return""!==t&&!ek.test(t)},eA=(e,t)=>{let a=[],n=[],l=!1,r=9,o=!1;if("ass"===t){let t=e.findIndex(e=>"[Events]"===e.trim());if(-1!==t){for(let a=t;a<e.length;a++)if(e[a].startsWith("Format:")){r=e[a].split(",").length-1,o=!0;break}}if(!o){let t=e.filter(e=>e.startsWith("Dialogue:")).slice(0,100);t.length>0&&(r=Math.min(...t.map(e=>e.split(",").length-1)))}}return e.forEach((e,o)=>{let i=!1,s="",c=e.trim();if("srt"===t||"vtt"===t){if(!l&&(/^[\d:,]+ --> [\d:,]+$/.test(e)||/^[\d:.]+ --> [\d:.]+$/.test(e))&&(l=!0),l){if("vtt"===t){let t=/^[\d:.]+ --> [\d:.]+$/.test(c),a=c.startsWith("WEBVTT"),n=c.startsWith("#");i=eE(e)&&!t&&!a&&!n,s=e}else{let t=/^[\d:,]+ --> [\d:,]+$/.test(c);i=eE(e)&&!t,s=e}}}else if("lrc"===t)!l&&ej.test(c)&&(l=!0),l&&(s=c.replace(/\[\d{2}:\d{2}(\.\d{2,3})?\]/g,"").trim(),i=eE(e));else if("ass"===t&&(!l&&c.startsWith("Dialogue:")&&(l=!0),l)){let t=e.split(",");e.startsWith("Dialogue:")&&t.length>r&&(s=t.slice(r).join(",").trim(),i=eE(e))}i&&(a.push(s),n.push(o))}),{contentLines:a,contentIndices:n,styleBlockLines:[]}},eK=/^(?:(\d+):)?(\d{2}):(\d{2})[,.](\d{1,3})$/,eZ=e=>{let t=e.match(eK);if(!t)return e;let[a,n,l,r,o]=t,i=o.length>=2?o.substring(0,2):o.padStart(2,"0");return"".concat(parseInt(n||"0",10),":").concat(l,":").concat(r,".").concat(i)},eM=()=>{let e=(0,f.T)("CopyToClipboard");return{copyToClipboard:async(t,a,n)=>{var l;if(!t||""===t.trim()){let t=n?"".concat(n).concat(e("empty")):e("empty");null==a||a.warning(t);return}if(!(null===(l=navigator)||void 0===l?void 0:l.clipboard)){null==a||a.error(e("unsupported"));return}try{await navigator.clipboard.writeText(t);let l=n?"".concat(n).concat(e("success")):e("success");null==a||a.success(l)}catch(l){console.error("Copy to clipboard failed: ",l);let t=n?"".concat(n).concat(e("failure")):e("failure");null==a||a.error(t)}}}},{TextArea:eN}=c.default,{Dragger:ez}=eu.default,{Paragraph:eI}=r.default;var eO=()=>{let e=(0,f.T)("subtitle"),t=(0,f.T)("common"),{sourceOptions:a,targetOptions:r}=T(),{copyToClipboard:o}=eM(),{isFileProcessing:i,fileList:s,multipleFiles:v,readFile:y,sourceText:b,setSourceText:x,uploadMode:w,singleFileMode:j,setSingleFileMode:k,handleFileUpload:E,handleUploadRemove:A,handleUploadChange:K,resetUpload:Z}=Q(),{exportSettings:M,importSettings:N,translationMethod:z,setTranslationMethod:I,translateContent:O,handleTranslate:F,getCurrentConfig:R,handleConfigChange:_,sourceLanguage:U,targetLanguage:D,target_langs:J,setTarget_langs:H,useCache:W,setUseCache:q,removeChars:G,setRemoveChars:Y,multiLanguageMode:ee,setMultiLanguageMode:et,translatedText:ea,setTranslatedText:en,translateInProgress:el,setTranslateInProgress:eo,progressPercent:ei,setProgressPercent:es,extractedText:ec,setExtractedText:eu,handleLanguageChange:eL,delay:ek,validateTranslate:eE}=er(),[eK,eO]=u.ZP.useMessage(),eF=(0,l.useMemo)(()=>$(b),[b]),eR=(0,l.useMemo)(()=>$(ea),[ea]),[e_,eU]=(0,l.useState)(!1),[eD,eB]=(0,l.useState)("below"),[eJ,eH]=(0,l.useState)(!0);(0,l.useEffect)(()=>{eu(""),en("")},[b,eu,en]);let e$=async function(n,l,r,o){let i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=B(n),c=eC(s);if("error"===c){eK.error(e("unsupportedSub"));return}let u=9;if("ass"===c){let e=s.findIndex(e=>"[Events]"===e.trim());if(-1!==e){for(let t=e;t<s.length;t++)if(s[t].startsWith("Format:")){u=s[t].split(",").length-1;break}}if(9===u){let e=s.filter(e=>e.startsWith("Dialogue:")).slice(0,100);e.length>0&&(u=Math.min(...e.map(e=>e.split(",").length-1)))}}let{contentLines:d,contentIndices:g,styleBlockLines:p}=eA(s,c),m=ee?J:[D];if(ee&&0===m.length){eK.error(t("noTargetLanguage"));return}for(let n of m){var h,y;try{let e=await O(d,z,n,r,o,i&&eJ),t=[...s];g.forEach((a,n)=>{if("ass"===c){let l=s[a],r=l.substring(0,l.split(",",u).join(",").length+1);if(e_){let o=e[n];t[a]="below"===eD?"".concat(l,"\\N").concat(o):"".concat(r).concat(o,"\\N").concat(l.split(",").slice(u).join(",").trim())}else t[a]="".concat(r).concat(e[n])}else if("lrc"===c){let l=s[a],r=(l.match(RegExp(ej.source,"g"))||[]).join("");if(e_){let o=e[n],i=l.replace(RegExp(ej.source,"g"),"").trim();"below"===eD?t[a]="".concat(r," ").concat(i," / ").concat(o):t[a]="".concat(r," ").concat(o," / ").concat(i)}else t[a]="".concat(r," ").concat(e[n])}else t[a]=e_?"".concat(s[a],"\n").concat(e[n]):e[n]});let a="";if(e_&&("srt"===c||"vtt"===c)){let t={};g.forEach((a,n)=>{let l="",r=a-1;for(;r>=0;){if(eS.test(s[r])){l=s[r];break}r--}if(!l)return;let[o,i]=l.split(" --> "),c=eZ(o.trim()),u=eZ(i.trim()),d="".concat(c," --> ").concat(u),g=s[a],p=e[n],m="above"===eD,h=m?g:p,v=m?p:g;t[d]?(t[d].first+="\\N".concat(h),t[d].second+="\\N".concat(v)):t[d]={first:"Dialogue: 0,".concat(c,",").concat(u,",Secondary,NTP,0000,0000,0000,,").concat(h),second:"Dialogue: 0,".concat(c,",").concat(u,",Default,NTP,0000,0000,0000,,").concat(v)}});let n=Object.values(t).map(e=>{let{first:t,second:a}=e;return"".concat(t,"\n").concat(a)}).join("\n");a="".concat("[Script Info]\nTitle: Bilingual Subtitles\nScriptType: v4.00+\nWrapStyle: 0\nScaledBorderAndShadow: Yes\nPlayResX: 1920\nPlayResY: 1080\nCollisions: Normal\n\n[V4+ Styles]\nFormat: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding\nStyle: Default,Noto Sans,70,&H00FFFFFF,&H0000FFFF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,2,1,2,30,30,35,1\nStyle: Secondary,Noto Sans,55,&H003CF7F4,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,2,1,2,30,30,35,1\n\n[Events]\nFormat: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text","\n").concat(n)}else a=[...t.slice(0,g[0]),...p,...t.slice(g[0])].join("\n");G.trim()&&X(G).forEach(e=>{a=a.replaceAll(e,"")});let y=".".concat(eP(c,e_)),f=l||(null===(h=v[0])||void 0===h?void 0:h.name)||"subtitle",b=f.lastIndexOf("."),x=-1!==b?f.slice(0,b):f,T="".concat(x,"_").concat(n).concat(y);(ee||v.length>1)&&await V(a,T),(!ee||ee&&n===m[0])&&en(a),ee&&n!==m[m.length-1]&&await ek(500)}catch(l){console.log(l),eK.open({type:"error",content:e_?"".concat(l.message," ").concat(e("bilingualError")):"".concat(l.message," ").concat((null===(y=a.find(e=>e.value===n))||void 0===y?void 0:y.label)||n,"  ").concat(t("translationError")),duration:5})}}},eX=async()=>{if(await eE()){if(0===v.length){eK.error(e("noFileUploaded"));return}eo(!0),es(0);for(let e=0;e<v.length;e++){let t=v[e];await new Promise(a=>{y(t,async n=>{await e$(n,t.name,e,v.length),await ek(1500),a()})})}eo(!1),eK.success(e("translationComplete"),10)}},eW=()=>{var e;let t=null===(e=v[0])||void 0===e?void 0:e.name,a=eC(B(b)),n=".".concat(eP(a,e_)),l=t?t.replace(/\.[^/.]+$/,"")+n:"subtitle".concat(n);return V(ea,l),l},eq=R();return(0,n.jsxs)(ed.Z,{spinning:i,size:"large",children:[eO,(0,n.jsxs)(ez,{customRequest:e=>{let{file:t}=e;return E(t)},accept:".srt,.ass,.vtt,.lrc",multiple:!j,showUploadList:!0,beforeUpload:j?Z:void 0,onRemove:A,onChange:K,fileList:s,children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(eb.Z,{})}),(0,n.jsx)("p",{className:"ant-upload-text",children:e("dragAndDropText")})]}),"single"===w&&(0,n.jsx)(eN,{placeholder:e("pasteUploadContent"),value:eF.displayText,onChange:eF.isTooLong?void 0:e=>x(e.target.value),rows:8,className:"mt-1 mb-2",allowClear:!0,readOnly:eF.isTooLong}),b&&(0,n.jsxs)(eI,{type:"secondary",className:"-mt-1 mb-2",children:[t("inputStatsTitle"),": ",eF.charCount," ",t("charLabel"),", ",eF.lineCount," ",t("lineLabel")]}),(0,n.jsxs)(h.Z,{layout:"inline",labelWrap:!0,className:"gap-1 mb-2",children:[(0,n.jsx)(h.Z.Item,{label:t("translationAPI"),children:(0,n.jsxs)(g.Z.Compact,{children:[(0,n.jsx)(eg.Z,{showSearch:!0,value:z,onChange:e=>I(e),options:P,style:{minWidth:150}}),(null==eq?void 0:eq.apiKey)!==void 0&&"llm"!==z&&(0,n.jsx)(p.Z,{title:"".concat(t("enter")," ").concat(L(z)," API Key"),children:(0,n.jsx)(c.default.Password,{autoComplete:"off",placeholder:"API Key ".concat(L(z)," "),value:eq.apiKey,onChange:e=>_(z,"apiKey",e.target.value)})})]})}),(0,n.jsx)(h.Z.Item,{label:t("sourceLanguage"),children:(0,n.jsx)(eg.Z,{value:U,onChange:e=>eL("source",e),options:a,showSearch:!0,placeholder:t("selectSourceLanguage"),optionFilterProp:"children",filterOption:(e,t)=>S({input:e,option:t}),style:{minWidth:120}})}),(0,n.jsx)(g.Z,{wrap:!0,children:(0,n.jsx)(h.Z.Item,{label:t("targetLanguage"),children:ee?(0,n.jsx)(eg.Z,{mode:"multiple",allowClear:!0,value:J,onChange:e=>H(e),options:r,placeholder:t("selectMultiTargetLanguages"),optionFilterProp:"children",filterOption:(e,t)=>S({input:e,option:t}),style:{minWidth:300}}):(0,n.jsx)(eg.Z,{value:D,onChange:e=>eL("target",e),options:r,showSearch:!0,placeholder:t("selectTargetLanguage"),optionFilterProp:"children",filterOption:(e,t)=>S({input:e,option:t}),style:{minWidth:120}})})}),(0,n.jsx)(h.Z.Item,{label:e("subtitleFormat"),children:(0,n.jsxs)(g.Z,{wrap:!0,children:[(0,n.jsx)(p.Z,{title:e("bilingualTooltip"),children:(0,n.jsx)(ep.Z,{checked:e_,onChange:e=>eU(e.target.checked),children:e("bilingual")})}),e_&&(0,n.jsxs)(em.ZP.Group,{value:eD,onChange:e=>eB(e.target.value),optionType:"button",buttonStyle:"solid",size:"small",children:[(0,n.jsx)(em.ZP.Button,{value:"above",children:e("translationAbove")}),(0,n.jsx)(em.ZP.Button,{value:"below",children:e("translationBelow")})]})]})}),(0,n.jsx)(h.Z.Item,{label:t("advancedSettings"),children:(0,n.jsxs)(g.Z,{wrap:!0,children:[(0,n.jsx)(p.Z,{title:t("singleFileModeTooltip"),children:(0,n.jsx)(ep.Z,{checked:j,onChange:e=>k(e.target.checked),children:t("singleFileMode")})}),(0,n.jsx)(p.Z,{title:t("useCacheTooltip"),children:(0,n.jsx)(ep.Z,{checked:W,onChange:e=>q(e.target.checked),children:t("useCache")})}),C.includes(z)&&(0,n.jsx)(p.Z,{title:t("contextAwareTranslationTooltip"),children:(0,n.jsx)(ep.Z,{checked:eJ,onChange:e=>eH(e.target.checked),children:t("contextAwareTranslation")})}),(0,n.jsx)(p.Z,{title:t("multiLanguageModeTooltip"),children:(0,n.jsx)(eh.Z,{checked:ee,onChange:e=>et(e),checkedChildren:t("multiLanguageMode"),unCheckedChildren:t("singleLanguageMode")})})]})}),(0,n.jsx)(h.Z.Item,{label:t("removeCharsAfterTranslation"),children:(0,n.jsx)(p.Z,{title:t("removeCharsAfterTranslationTooltip"),children:(0,n.jsx)(c.default,{placeholder:"".concat(t("example"),": ♪ <i> </i>"),value:G,onChange:e=>Y(e.target.value),style:{minWidth:200},allowClear:!0})})})]}),(0,n.jsxs)(ev.Z,{gap:"small",children:[(0,n.jsx)(m.ZP,{type:"primary",block:!0,onClick:()=>"single"===w?F(e$,b,eJ):eX(),disabled:el,children:ee?"".concat(t("translate")," | ").concat(t("totalLanguages")).concat(J.length||0):t("translate")}),(0,n.jsx)(p.Z,{title:t("exportSettingTooltip"),children:(0,n.jsx)(m.ZP,{icon:(0,n.jsx)(ex.Z,{}),onClick:async()=>{await M()},children:t("exportSetting")})}),(0,n.jsx)(p.Z,{title:t("importSettingTooltip"),children:(0,n.jsx)(m.ZP,{icon:(0,n.jsx)(eT.Z,{}),onClick:async()=>{await N()},children:t("importSetting")})}),(0,n.jsx)(p.Z,{title:t("resetUploadTooltip"),children:(0,n.jsx)(m.ZP,{onClick:()=>{Z(),en(""),eK.success(t("resetUploadSuccess"))},children:t("resetUpload")})}),"single"===w&&b&&(0,n.jsx)(m.ZP,{onClick:()=>{if(!b.trim()){eK.error(e("noSourceText"));return}let t=B(b),a=eC(t);"error"===a&&eK.error(e("unsupportedSub"));let{contentLines:n}=eA(t,a),l=n.join("\n").trim();if(!l){eK.error(e("noExtractedText"));return}eu(l),o(l,eK,e("textExtracted"))},children:t("extractText")})]}),"single"===w&&(0,n.jsxs)(n.Fragment,{children:[ea&&!(ee&&J.length>1)&&(0,n.jsxs)(d.Z,{title:t("translationResult"),className:"mt-3",extra:(0,n.jsxs)(g.Z,{wrap:!0,children:[(0,n.jsx)(m.ZP,{icon:(0,n.jsx)(ew.Z,{}),onClick:()=>o(ea,eK),children:t("copy")}),(0,n.jsx)(m.ZP,{icon:(0,n.jsx)(ex.Z,{}),onClick:()=>{let e=eW();eK.success("".concat(t("exportedFile"),": ").concat(e))},children:t("exportFile")})]}),children:[(0,n.jsx)(eN,{value:eR.displayText,rows:10,readOnly:!0}),(0,n.jsxs)(eI,{type:"secondary",className:"-mb-2",children:[t("outputStatsTitle"),": ",eR.charCount," ",t("charLabel"),", ",eR.lineCount," ",t("lineLabel")]})]}),ec&&(0,n.jsx)(d.Z,{title:t("extractedText"),className:"mt-3",extra:(0,n.jsx)(m.ZP,{icon:(0,n.jsx)(ew.Z,{}),onClick:()=>o(ec,eK),children:t("copy")}),children:(0,n.jsx)(eN,{value:ec,rows:10,readOnly:!0})})]}),el&&(0,n.jsx)(ey.Z,{title:t("translating"),open:el,footer:null,closable:!1,children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(ef.Z,{type:"circle",percent:Math.round(100*ei)/100}),ee&&J.length>0&&(0,n.jsx)("p",{className:"mt-4",children:"".concat(t("multiTranslating")," ").concat(J.length)})]})})]})},eF=a(11675);let{Title:eR,Paragraph:e_,Link:eU}=r.default;var eD=()=>{let e=(0,f.T)("subtitle"),t=(0,f.T)("common"),a=(0,eF.bU)(),r="zh"===a||"zh-hant"===a,c=(0,l.useMemo)(()=>r?"https://docs.newzone.top/guide/translation/subtitle-translator/index.html":"https://docs.newzone.top/en/guide/translation/subtitle-translator/index.html",[r]),[u,d]=(0,l.useState)("basic"),[g,p]=(0,l.useState)(Date.now()),m=(0,l.useCallback)(e=>{d(e),p(Date.now())},[]),h=(0,n.jsx)(eO,{},"basic-".concat(g)),v=(0,n.jsx)(ec,{},"advanced-".concat(g)),y=[{key:"basic",label:t("basicTab"),children:h},{key:"advanced",label:t("advancedTab"),children:v}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(eR,{level:3,children:[(0,n.jsx)(i.Z,{})," ",e("clientTitle")]}),(0,n.jsxs)(e_,{type:"secondary",ellipsis:{rows:3,expandable:!0,symbol:"more"},children:[(0,n.jsxs)(eU,{href:c,target:"_blank",rel:"noopener noreferrer",children:[(0,n.jsx)(s.Z,{})," ",t("userGuide")]})," ",e("clientDescription")," ",t("privacyNotice")]}),(0,n.jsx)(o.Z,{activeKey:u,onChange:m,items:y,type:"card",className:"w-full",destroyOnHidden:!0,animated:{inkBar:!0,tabPane:!0}})]})}}},function(e){e.O(0,[102,674,737,971,117,744],function(){return e(e.s=56723)}),_N_E=e.O()}]);